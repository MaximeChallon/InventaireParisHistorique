{% extends "container.html" %}

{% block titre %}
Catalogue
{% endblock %}


{% block corps %}
<script src="https://unpkg.com/itemsjs@latest/dist/itemsjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">
$(document).ready(function() {
$.ajax({
  url: "{{ url_for('get_json_final')}}",
  dataType: 'json'
}).done(function (data) {
  loadData(data);});

  var photos = [];

              function loadData(data) {
        $.each(data, function(index, row) {
          photos.push([
            row.Taille,
            row.Support
          ]);
        });


        var configuration = {
  searchableFields: ['Support', 'Taille'],
  sortings: {
    name_asc: {
      field: 'Numero_inventaire',
      order: 'asc'
    }
  },
  aggregations: {
    Support: {
      title: 'Support',
      size: 10
    },
    Taille: {
      title: 'Taille',
      size: 10
    }
  }
};

itemsjs = itemsjs(data, configuration);

const vm = new Vue({
  el: '#el',
  delimiters : ['${', '}%'],
  data: function () {

    // making it more generic
    var filters = {};
    Object.keys(configuration.aggregations).map(function(v) {
      filters[v] = [];
    })

    return {
      query: '',
      // initializing filters with empty arrays
      filters: filters,
    }
  },
  methods: {
    reset: function () {
      var filters = {};
      Object.keys(configuration.aggregations).map(function(v) {
        filters[v] = [];
      })

      this.filters = filters;
      this.query = '';
    }
  },
  computed: {
    searchResult: function () {

      var result = itemsjs.search({
        query: this.query,
        filters: this.filters
      })
      return result
    }
  }
});
      }
});

</script>

<div class="container" style="margin-top: 50px;" id="el">

    <h1>List of items (${ searchResult.pagination.total }%)</h1>

    <p class="text-muted">Search performed in ${ searchResult.timings.search }% ms, facets in ${ searchResult.timings.facets }% ms</p>

    <div class="row">
      <div class="col-md-2 col-xs-2">
        <div v-for="facet in searchResult.data.aggregations">
          <h5 style="margin-bottom: 5px;"><strong style="color: #337ab7;">${ facet.N_i }%</strong></h5>

          <ul class="browse-list list-unstyled long-list" style="margin-bottom: 0;">
            <li v-for="bucket in facet.buckets">
            <div class="checkbox block" style="margin-top: 0; margin-bottom: 0;">
              <label>
                  <input class="checkbox" type="checkbox" v-model="filters[facet.name]" v-bind:value="bucket.key">
                ${ bucket.key }% (${ bucket.doc_count }%)
              </label>
            </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="col-md-10 col-xs-10">
        <div class="breadcrumbs"></div>
        <div class="clearfix"></div>
        <!--<h3>List of items (${ searchResult.pagination.total }%)</h3>-->
        <table class="table table-striped">
          <tbody>
          <tr v-for="item of searchResult.data.items">
            <td>
              <b>${ item.Rue }%</b>
              <br />
              ${ item.Nom_site }%
            </td>
            <td></td>
            <td>
              <span style="font-size: 12px; display: block; float: left; background-color: #dbebf2; border-radius: 5px; padding: 1px 3px 1px 3px; margin: 2px;" v-for="tag in item.M_c">${ tag }%</span>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="clearfix"></div>
      </div>

      <div class="clearfix" style="margin-bottom: 100px;"></div>
    </div>
  </div>
{% endblock %}