{% extends "container.html" %}

{% block titre %}
Catalogue
{% endblock %}


{% block corps %}
<script src="https://unpkg.com/itemsjs@latest/dist/itemsjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">
$(document).ready(function() {
$.ajax({
  url: "{{ url_for('get_json_final')}}",
  dataType: 'json'
}).done(function (data) {
  loadData(data);});

  var photos = [];

              function loadData(data) {
        $.each(data, function(index, row) {
          photos.push([
            row.Taille,
            row.Support
          ]);
        });


        var configuration = {
  searchableFields: ['Support', 'Taille', 'Mots-cles', 'Arrondissement'],
  sortings: {
    name_asc: {
      field: 'N_inventaire',
      order: 'asc'
    }
  },
  aggregations: {
    Support: {
      title: 'Support',
      size: 10
    },
    Taille: {
      title: 'Taille',
      size: 10
    },
    Mots_cles: {
      title: 'Mots clés',
      size: 30
    },
    Arrondissement: {
      title: 'Arrondissement',
      size: 20
    }
  }
};

itemsjs = itemsjs(data, configuration);

const vm = new Vue({
  el: '#el',
  delimiters : ['${', '}%'],
  data: function () {

    // making it more generic
    var filters = {};
    Object.keys(configuration.aggregations).map(function(v) {
      filters[v] = [];
    })

    return {
      query: '',
      // initializing filters with empty arrays
      filters: filters,
    }
  },
  methods: {
    reset: function () {
      var filters = {};
      Object.keys(configuration.aggregations).map(function(v) {
        filters[v] = [];
      })

      this.filters = filters;
      this.query = '';
    }
  },
  computed: {
    searchResult: function () {

      var result = itemsjs.search({
        query: this.query,
        filters: this.filters
      })
      return result
    }
  }
});
      }
});

</script>

<div class="container" style="margin-top: 50px;" id="el">

    <h1 style="font-size:16pt;color:#da1916;">Liste globale des photographies (${ searchResult.pagination.total }%)</h1>

    <p class="text-muted">Facettes créées en ${ searchResult.timings.facets }% ms</p>

    <div class="row">


      <div class="btn-group" v-for="facet in searchResult.data.aggregations" style="margin-left:15px;margin-bottom:15px;">
  <button type="button" class="btn btn-danger">${ facet.title }%</button>
  <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <span class="sr-only">${ facet.title }%</span>
  </button>
  <div class="dropdown-menu">
    <div class="dropdown-item" v-for="bucket in facet.buckets">
            <label>
             <input class="checkbox" type="checkbox" v-model="filters[facet.name]" v-bind:value="bucket.key">
                ${ bucket.key }% (${ bucket.doc_count }%)
            </label>
          </div>
  </div>
</div>




    </div>

    <div class="row">
    <div class="col-md-12 col-xs-12">
        <div class="breadcrumbs"></div>
        <div class="clearfix"></div>
        <table class="table table-striped">
          <tbody>
          <tr v-for="item of searchResult.data.items">
            <td>
              <b>${ item.Rue }%</b>
              <br />
              ${ item.Nom_site }%
            </td>
            <td></td>
            <td>
              <span style="font-size: 12px; display: block; float: left; background-color: #dbebf2; border-radius: 5px; padding: 1px 3px 1px 3px; margin: 2px;" v-for="tag in item.Mots_cles">${ tag }%</span>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="clearfix"></div>
      </div>

      <div class="clearfix" style="margin-bottom: 100px;"></div>
    </div>
  </div>
{% endblock %}